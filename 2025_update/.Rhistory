reg_current_tenure <- psrc_pums_count(pums, group_vars = c("tenure"),rr=TRUE)
#-------------- Regional Analysis - Unit Size by Decade ---------------
reg_allunits <- psrc_pums_count(pums, decade, group_vars = c("decade", "unit_size"),rr=TRUE)
reg_allunits_analysis_reliability <- reg_allunits %>%
filter(unit_size != "Total") %>%
select(decade, unit_size, reliability) %>%
pivot_wider(names_from = decade, values_from = reliability) %>%
mutate(unit_size = factor(unit_size, levels = unit_size_order)) %>%
arrange(unit_size)
reg_allunits_share <- reg_allunits %>%
filter(unit_size != "Total") %>%
select(decade, unit_size, share) %>%
pivot_wider(names_from = decade, values_from = share) %>%
mutate(across(everything(), as.character),
unit_size = factor(unit_size, levels = unit_size_order)) %>%
arrange(unit_size)
reg_allunits_analysis_count <- reg_allunits %>%
filter(unit_size != "Total") %>%
select(decade, unit_size, count) %>%
pivot_wider(names_from = decade, values_from = count) %>%
mutate(across(everything(), as.character),
unit_size = factor(unit_size, levels = unit_size_order)) %>%
arrange(unit_size)
reg_allunits_analysis <- bind_rows(reg_allunits_analysis_count, reg_allunits_share, reg_allunits_analysis_reliability)
rm(reg_allunits, reg_allunits_analysis_reliability, reg_allunits_share, reg_allunits_analysis_count)
View(reg_allunits_analysis)
View(reg_current_tenure)
View(reg_current_unit_size)
View(reg_current_yr_built)
reg_rntr <- psrc_pums_count(pums, decade, group_vars = c("tenure", "decade", "unit_size_rntr"),rr=TRUE)
reg_rntr_analysis_reliability <- reg_rntr %>%
filter(tenure == "renter", unit_size_rntr != "Total") %>%
select(decade, unit_size_rntr, reliability) %>%
pivot_wider(names_from = decade, values_from = reliability) %>%
mutate(unit_size_rntr = factor(unit_size_rntr, levels = unit_size_order)) %>%
arrange(unit_size_rntr)
reg_rntr_analysis_share <- reg_rntr %>%
filter(tenure == "renter", unit_size_rntr != "Total") %>%
select(decade, unit_size_rntr, share) %>%
pivot_wider(names_from = decade, values_from = share) %>%
mutate(across(everything(), as.character),
unit_size_rntr = factor(unit_size_rntr, levels = unit_size_order)) %>%
arrange(unit_size_rntr)
reg_rntr_analysis_count <- reg_rntr %>%
filter(tenure == "renter", unit_size_rntr != "Total") %>%
select(decade, unit_size_rntr, count) %>%
pivot_wider(names_from = decade, values_from = count) %>%
mutate(across(everything(), as.character),
unit_size_rntr = factor(unit_size_rntr, levels = unit_size_order)) %>%
arrange(unit_size_rntr)
reg_rntr_analysis <- bind_rows(reg_rntr_analysis_count, reg_rntr_analysis_share, reg_rntr_analysis_reliability)
rm(reg_rntr, reg_rntr_analysis_count, reg_rntr_analysis_share, reg_rntr_analysis_reliability)
reg_ownr <- psrc_pums_count(pums, decade, group_vars = c("tenure", "decade", "unit_size_ownr"),rr=TRUE)
reg_ownr_analysis_reliability <- reg_ownr %>%
filter(tenure == "owner", unit_size_ownr != "Total") %>%
select(decade, unit_size_ownr, reliability) %>%
pivot_wider(names_from = decade, values_from = reliability) %>%
mutate(unit_size_ownr = factor(unit_size_ownr, levels = unit_size_order)) %>%
arrange(unit_size_ownr)
reg_ownr_analysis_share <- reg_ownr %>%
filter(tenure == "owner", unit_size_ownr != "Total") %>%
select(decade, unit_size_ownr, share) %>%
pivot_wider(names_from = decade, values_from = share) %>%
mutate(across(everything(), as.character),
unit_size_ownr = factor(unit_size_ownr, levels = unit_size_order)) %>%
arrange(unit_size_ownr)
reg_ownr_analysis_count <- reg_ownr %>%
filter(tenure == "owner", unit_size_ownr != "Total") %>%
select(decade, unit_size_ownr, count) %>%
pivot_wider(names_from = decade, values_from = count) %>%
mutate(across(everything(), as.character),
unit_size_ownr = factor(unit_size_ownr, levels = unit_size_order)) %>%
arrange(unit_size_ownr)
reg_ownr_analysis <- bind_rows(reg_ownr_analysis_count, reg_ownr_analysis_share, reg_ownr_analysis_reliability)
rm(reg_ownr,reg_ownr_analysis_count, reg_ownr_analysis_share, reg_ownr_analysis_reliability)
View(reg_ownr_analysis)
View(reg_rntr_analysis)
View(reg_current_yr_built)
#-------------- Regional Analyses --------------
reg_current_yr_built_1YR <- psrc_pums_count(pums, group_vars = c("decade"),rr=TRUE)
library(psrccensus)
library(magrittr)
library(dplyr)
library(tidyr)
library(openxlsx)
# Assumptions
year <- c(2023)
unit_size_order <- c("studio","studio & 1bed", "1bed", "2bed", "3bed", "3bed+", "4bed+")
seattle_pumas <- c(23318, 23316, 23317, 23315, 23314, 23312, 23313) #2020 decennial boundaries
#PUMAs found here: https://psrc-psregcncl.hub.arcgis.com/datasets/5ad2945593df403eadbb6f6756ebb49c_0/explore?location=47.603732%2C-122.364195%2C10.92
export_path <- "J:/Projects/V2050/Housing/Monitoring/2025Update/Early Exploratory Work"
source_info <- c("2023 American Community Survey (ACS) PUMS, 5-Year. Crunched by Eric Clute.")
#-------------- Pull Data --------------
pums_raw <- get_psrc_pums(5, year, "h", c("BDSP", "YRBLT", "TEN", "PUMA"))
pums <- pums_raw %>%
mutate(
unit_size = factor(case_when(
BDSP == "0" ~ "studio",
BDSP == "1" ~ "1bed",
BDSP == "2" ~ "2bed",
BDSP == "3" ~ "3bed",
BDSP %in% c("4", "5", "6", "7") ~ "4bed+",
TRUE ~ "other")),
unit_size_rntr = factor(case_when(
BDSP == "0" ~ "studio",
BDSP == "1" ~ "1bed",
BDSP == "2" ~ "2bed",
BDSP %in% c("3", "4", "5", "6", "7") ~ "3bed+",
TRUE ~ "other")),
unit_size_ownr = factor(case_when(
BDSP %in% c("0", "1") ~ "studio & 1bed",
BDSP == "2" ~ "2bed",
BDSP == "3" ~ "3bed",
BDSP %in% c("4", "5", "6", "7") ~ "4bed+",
TRUE ~ "other")),
decade = factor(case_when(
YRBLT == "1980 to 1989" ~ "1980s",
YRBLT == "1990 to 1999" ~ "1990s",
YRBLT == "2000 to 2009" ~ "2000s",
YRBLT == "2010 to 2019" ~ "2010s",
YRBLT %in% as.character(2020:year) ~ "2020s",
TRUE ~ "1970s and earlier")),
tenure=factor(case_when(
TEN == "Owned free and clear" ~ "owner",
TEN == "Owned with mortgage or loan (include home equity loans)" ~ "owner",
TRUE ~ "renter")),
kc_binary=factor(case_when(
COUNTY == "King" ~ "King",
TRUE ~ "Outside King")),
sea_binary=factor(case_when(
PUMA %in% seattle_pumas ~ "seattle",
TRUE ~ "outside seattle"))
)
#-------------- Regional Analyses --------------
reg_current_yr_built_5YR <- psrc_pums_count(pums, group_vars = c("decade"),rr=TRUE)
View(reg_current_yr_built_1YR)
View(reg_current_yr_built_5YR)
View(reg_allunits_analysis)
# TITLE: Housing Unit Productin by Size, Tenure, and Decade
# GEOGRAPHIES: PSRC Region & County
# DATA SOURCE: 5YR ACS PUMS
# DATE CREATED: 01.28.2025
# AUTHOR: Eric Clute
library(psrccensus)
library(magrittr)
library(dplyr)
library(tidyr)
library(openxlsx)
# Assumptions
year <- c(2024)
unit_size_order <- c("studio","studio & 1bed", "1bed", "2bed", "3bed", "3bed+", "4bed+")
seattle_pumas <- c(23318, 23316, 23317, 23315, 23314, 23312, 23313) #2020 decennial boundaries
#PUMAs found here: https://psrc-psregcncl.hub.arcgis.com/datasets/5ad2945593df403eadbb6f6756ebb49c_0/explore?location=47.603732%2C-122.364195%2C10.92
export_path <- "J:/Projects/V2050/Housing/Monitoring/2025Update/Early Exploratory Work"
source_info <- c("2023 American Community Survey (ACS) PUMS, 5-Year. Crunched by Eric Clute.")
#-------------- Pull Data --------------
pums_raw <- get_psrc_pums(5, year, "h", c("BDSP", "YRBLT", "TEN", "PUMA"))
library(psrccensus)
library(magrittr)
library(dplyr)
library(tidyr)
library(openxlsx)
# Assumptions
year <- c(2024)
unit_size_order <- c("studio","studio & 1bed", "1bed", "2bed", "3bed", "3bed+", "4bed+")
seattle_pumas <- c(23318, 23316, 23317, 23315, 23314, 23312, 23313) #2020 decennial boundaries
#PUMAs found here: https://psrc-psregcncl.hub.arcgis.com/datasets/5ad2945593df403eadbb6f6756ebb49c_0/explore?location=47.603732%2C-122.364195%2C10.92
export_path <- "J:/Projects/V2050/Housing/Monitoring/2025Update/Early Exploratory Work"
source_info <- c("2023 American Community Survey (ACS) PUMS, 5-Year. Crunched by Eric Clute.")
#-------------- Pull Data --------------
pums_raw <- get_psrc_pums(1, year, "h", c("BDSP", "YRBLT", "TEN", "PUMA"))
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(dplyr)
library(zoo)
library(ggplot2)
library(openxlsx)
library(stringr)
permits_15_df<-read_excel('census_bps_monthly_2015_Oct2025.xlsx')
total_df<- permits_15_df%>%group_by(Month)%>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`))
View(permits_15_df)
View(total_df)
total_df<- permits_15_df%>%group_by(Month)%>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`))
total_df_3mth<-total_df%>%
mutate(multifamily=sum_Total-sum_1Unit)%>%
mutate(move_tot3_total=rollapply(sum_Total, 3, sum, align='right', fill=NA),
move_tot3_sf=rollapply(sum_1Unit, 3, sum, align='right', fill=NA),
move_tot3_mf=rollapply(multifamily, 3, sum, align='right', fill=NA))%>%
mutate(month_format=paste(substr(Month,1,4), substr(Month,5,6), sep='-'))
total_df_3mth_03 <- total_df_3mth %>%
filter(str_detect(Month, regex("03", ignore_case = TRUE)))
total_df_3mth_03 <- total_df_3mth_03[,c(1,2,5,6,7,8)]
total_df_3mth_06 <- total_df_3mth %>%
filter(str_detect(Month, regex("06", ignore_case = TRUE)))
total_df_3mth_06 <- total_df_3mth_06[,c(1,2,5,6,7,8)]
total_df_3mth_09 <- total_df_3mth %>%
filter(str_detect(Month, regex("09", ignore_case = TRUE)))
total_df_3mth_09 <- total_df_3mth_09[,c(1,2,5,6,7,8)]
total_df_3mth_12 <- total_df_3mth %>%
filter(str_detect(Month, regex("12", ignore_case = TRUE)))
total_df_3mth_12 <- total_df_3mth_12[,c(1,2,5,6,7,8)]
all <- rbind(total_df_3mth_03, total_df_3mth_06, total_df_3mth_09, total_df_3mth_12)
#write.xlsx(all, 'census_bps_quarterly.xlsx')
View(all)
View(total_df)
View(total_df_3mth)
total_df<- permits_15_df %>% group_by(Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit)
View(total_df)
total_df<- permits_15_df %>% group_by(Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit) %>%
select!(`1 Unit`)
total_df<- permits_15_df %>% group_by(Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit) %>%
select(!`1 Unit`)
total_df<- permits_15_df %>% group_by(Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit) %>%
select(!sum1Unit)
total_df<- permits_15_df %>% group_by(Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit) %>%
select(!sum_1Unit)
View(total_df)
total_df<- permits_15_df %>% group_by(Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit)
total_df<- permits_15_df %>%
mutate(year = substr(Month, 1, 4))
View(total_df)
total_df<- permits_15_df %>%
mutate(year = substr(Month, 1, 4)) %>%
group_by(year, Month)
total_df<- permits_15_df %>%
mutate(year = substr(Month, 1, 4)) %>%
group_by(year, Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`))
total_df<- permits_15_df %>%
mutate(year = substr(Month, 1, 4)) %>%
group_by(year, Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit)
total_df<- permits_15_df %>%
mutate(year = substr(Month, 1, 4)) %>%
group_by(year, Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit) %>%
group_by(year)
total_df<- permits_15_df %>%
mutate(year = substr(Month, 1, 4)) %>%
group_by(year, Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit) %>%
group_by(year) %>%
summarise(yearly_Total = sum(sum_Total, na.rm = TRUE),
yearly_1Unit = sum(sum_1Unit, na.rm = TRUE),
yearly_multifamily = sum(multifamily, na.rm = TRUE),
.groups = "drop")
total_df<- permits_15_df %>%
mutate(year = substr(Month, 1, 4)) %>%
group_by(year, Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit) %>%
group_by(year) %>%
summarise(yearly_Total = sum(sum_Total, na.rm = TRUE),
yearly_singlefamily = sum(sum_1Unit, na.rm = TRUE),
yearly_multifamily = sum(multifamily, na.rm = TRUE),
avg_monthly_total = sum_Total / if_else(year == 2025, 10, 12), #2025 data is through Oct, divide by 10
avg_monthly_singlefamily = sum_1Unit / if_else(year == 2025, 10, 12), #all other years, divide by 12
avg_monthly_multifamily = multifamily / if_else(year == 2025, 10, 12),
.groups = "drop")
total_df<- permits_15_df %>%
mutate(year = substr(Month, 1, 4)) %>%
group_by(year, Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit) %>%
group_by(year) %>%
summarise(yearly_Total = sum(sum_Total, na.rm = TRUE),
yearly_singlefamily = sum(sum_1Unit, na.rm = TRUE),
yearly_multifamily = sum(multifamily, na.rm = TRUE),
avg_monthly_total = sum_Total / if_else(year = 2025, 10, 12), #2025 data is through Oct, divide by 10
avg_monthly_singlefamily = sum_1Unit / if_else(year == 2025, 10, 12), #all other years, divide by 12
avg_monthly_multifamily = multifamily / if_else(year == 2025, 10, 12),
.groups = "drop")
total_df<- permits_15_df %>%
mutate(year = substr(Month, 1, 4)) %>%
group_by(year, Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit) %>%
group_by(year) %>%
summarise(yearly_Total = sum(sum_Total, na.rm = TRUE),
yearly_singlefamily = sum(sum_1Unit, na.rm = TRUE),
yearly_multifamily = sum(multifamily, na.rm = TRUE),
avg_monthly_total = sum_Total / if_else(year == "2025", 10, 12), #2025 data is through Oct, divide by 10
avg_monthly_singlefamily = sum_1Unit / if_else(year == 2025, 10, 12), #all other years, divide by 12
avg_monthly_multifamily = multifamily / if_else(year == 2025, 10, 12),
.groups = "drop")
total_df<- permits_15_df %>%
mutate(year = substr(Month, 1, 4)) %>%
group_by(year, Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit) %>%
group_by(year) %>%
summarise(yearly_Total = sum(sum_Total, na.rm = TRUE),
yearly_singlefamily = sum(sum_1Unit, na.rm = TRUE),
yearly_multifamily = sum(multifamily, na.rm = TRUE),
months = if_else(first(year) == "2025", 10, 12), # 2025 data thru Oct, divide by 10 for monthly data
avg_monthly_total = sum_Total / months,
avg_monthly_singlefamily = sum_1Unit / months,
avg_monthly_multifamily = multifamily / months,
.groups = "drop")
total_df<- permits_15_df %>%
mutate(year = substr(Month, 1, 4)) %>%
group_by(year, Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit) %>%
# yearly and monthly avg totals
group_by(year) %>%
summarise(yearly_Total = sum(sum_Total, na.rm = TRUE),
yearly_singlefamily = sum(sum_1Unit, na.rm = TRUE),
yearly_multifamily = sum(multifamily, na.rm = TRUE),
months = if_else(first(year) == "2025", 10, 12), # 2025 data thru Oct, divide by 10 for monthly data
avg_monthly_total = yearly_Total / months,
avg_monthly_singlefamily = yearly_singlefamily / months,
avg_monthly_multifamily = yearly_multifamily / months,
.groups = "drop")
yrly_avgs <- permits_15_df %>%
mutate(year = substr(Month, 1, 4)) %>%
group_by(year, Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit) %>%
# yearly and monthly avg totals
group_by(year) %>%
summarise(yearly_Total = sum(sum_Total, na.rm = TRUE),
yearly_singlefamily = sum(sum_1Unit, na.rm = TRUE),
yearly_multifamily = sum(multifamily, na.rm = TRUE),
months = if_else(first(year) == "2025", 10, 12), # 2025 data thru Oct, divide by 10 for monthly data
avg_monthly_total = yearly_Total / months,
avg_monthly_singlefamily = yearly_singlefamily / months,
avg_monthly_multifamily = yearly_multifamily / months,
.groups = "drop")
View(yrly_avgs)
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(dplyr)
library(zoo)
library(ggplot2)
library(openxlsx)
library(stringr)
permits_15_df<-read_excel('census_bps_monthly_2015_Oct2025.xlsx')
total_df<- permits_15_df%>%group_by(Month)%>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`))
total_df_3mth<-total_df%>%
mutate(multifamily=sum_Total-sum_1Unit)%>%
mutate(move_tot3_total=rollapply(sum_Total, 3, sum, align='right', fill=NA),
move_tot3_sf=rollapply(sum_1Unit, 3, sum, align='right', fill=NA),
move_tot3_mf=rollapply(multifamily, 3, sum, align='right', fill=NA))%>%
mutate(month_format=paste(substr(Month,1,4), substr(Month,5,6), sep='-'))
total_df_3mth_03 <- total_df_3mth %>%
filter(str_detect(Month, regex("03", ignore_case = TRUE)))
total_df_3mth_03 <- total_df_3mth_03[,c(1,2,5,6,7,8)]
total_df_3mth_06 <- total_df_3mth %>%
filter(str_detect(Month, regex("06", ignore_case = TRUE)))
total_df_3mth_06 <- total_df_3mth_06[,c(1,2,5,6,7,8)]
total_df_3mth_09 <- total_df_3mth %>%
filter(str_detect(Month, regex("09", ignore_case = TRUE)))
total_df_3mth_09 <- total_df_3mth_09[,c(1,2,5,6,7,8)]
total_df_3mth_12 <- total_df_3mth %>%
filter(str_detect(Month, regex("12", ignore_case = TRUE)))
total_df_3mth_12 <- total_df_3mth_12[,c(1,2,5,6,7,8)]
all <- rbind(total_df_3mth_03, total_df_3mth_06, total_df_3mth_09, total_df_3mth_12)
#write.xlsx(all, 'census_bps_quarterly.xlsx')
yrly_and_mnthly_avgs <- permits_15_df %>%
mutate(year = substr(Month, 1, 4)) %>%
group_by(year, Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit) %>%
# yearly and monthly avg totals
group_by(year) %>%
summarise(yearly_Total = sum(sum_Total, na.rm = TRUE),
yearly_singlefamily = sum(sum_1Unit, na.rm = TRUE),
yearly_multifamily = sum(multifamily, na.rm = TRUE),
months = if_else(first(year) == "2025", 10, 12), # 2025 data thru Oct, divide by 10 for monthly data
avg_monthly_total = yearly_Total / months,
avg_monthly_singlefamily = yearly_singlefamily / months,
avg_monthly_multifamily = yearly_multifamily / months,
.groups = "drop")
housing_plot_q<-ggplot(all) +
geom_bar(aes(x=month_format, y=move_tot3_total,fill='Total'), stat="identity")+
geom_line(aes(x=month_format, y=move_tot3_sf,group =1, color='Single family detached & attached'),stat="identity")+
geom_line(aes(x=month_format, y=move_tot3_mf, color="Multifamily 2+ units",group=2),stat="identity",)+
scale_color_manual(values=c("#F05A28","#91268F"))+
scale_fill_manual(values=c("#A9D46E"))+
theme(axis.title.x=element_blank(),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
axis.title.y=element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(legend.position = "bottom",
legend.title = element_blank())+
labs(title="Permitted Housing Units, Central Puget Sound \n (Quarterly Totals)")
housing_plot_q
total_df<- permits_15_df%>%group_by(Month)%>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`))
total_df_3mth<-total_df%>%
mutate(multifamily=sum_Total-sum_1Unit)%>%
mutate(move_ave3_total=rollapply(sum_Total, 3, mean, align='right', fill=NA),
move_ave3_sf=rollapply(sum_1Unit, 3, mean, align='right', fill=NA),
move_ave3_mf=rollapply(multifamily, 3, mean, align='right', fill=NA))%>%
mutate(month_format=paste(substr(Month,1,4), substr(Month,5,6), sep='-'))
housing_plot<-ggplot(total_df_3mth) +
geom_bar(aes(x=month_format, y=move_ave3_total,fill='Total'), stat="identity")+
geom_line(aes(x=month_format, y=move_ave3_sf,group =1, color='Single family detached & attached'),stat="identity")+
geom_line(aes(x=month_format, y=move_ave3_mf, color="Multifamily 2+ units",group=2),stat="identity",)+
scale_color_manual(values=c("#F05A28","#91268F"))+
scale_fill_manual(values=c("#A9D46E"))+
theme(axis.title.x=element_blank(),
axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1),
axis.title.y=element_blank(),
panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))+
theme(legend.position = "bottom",
legend.title = element_blank())+
labs(title="Permitted Housing Units, Central Puget Sound \n (3 month average)")
housing_plot
housing_plot
View(yrly_and_mnthly_avgs)
yrly_and_mnthly_avgs <- permits_15_df %>%
mutate(year = substr(Month, 1, 4)) %>%
group_by(year, Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit) %>%
# yearly and monthly avg totals
group_by(year) %>%
summarise(yearly_total = sum(sum_Total, na.rm = TRUE),
yearly_singlefamily = sum(sum_1Unit, na.rm = TRUE),
yearly_multifamily = sum(multifamily, na.rm = TRUE),
months = if_else(first(year) == "2025", 10, 12), # 2025 data thru Oct, divide by 10 for monthly data
avg_monthly_total = yearly_total / months,
avg_monthly_singlefamily = yearly_singlefamily / months,
avg_monthly_multifamily = yearly_multifamily / months,
.groups = "drop")
yrly_and_mnthly_avgs <- permits_15_df %>%
mutate(year = substr(Month, 1, 4)) %>%
group_by(year, Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit) %>%
# yearly and monthly avg totals
group_by(year) %>%
summarise(yearly_total = sum(sum_Total, na.rm = TRUE),
yearly_singlefamily = sum(sum_1Unit, na.rm = TRUE),
yearly_multifamily = sum(multifamily, na.rm = TRUE),
months = if_else(first(year) == "2025", 10, 12)
View(yrly_and_mnthly_avgs)
yrly_and_mnthly_avgs <- permits_15_df %>%
mutate(year = substr(Month, 1, 4)) %>%
group_by(year, Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit) %>%
# yearly and monthly avg totals
group_by(year) %>%
summarise(yearly_total = sum(sum_Total, na.rm = TRUE),
yearly_singlefamily = sum(sum_1Unit, na.rm = TRUE),
yearly_multifamily = sum(multifamily, na.rm = TRUE),
months = if_else(first(year) == "2025", 10, 12))
View(yrly_and_mnthly_avgs)
yrly_and_mnthly_avgs <- permits_15_df %>%
mutate(year = substr(Month, 1, 4)) %>%
group_by(year, Month) %>%
summarise(sum_Total=sum(Total),
sum_1Unit=sum(`1 Unit`)) %>%
mutate(multifamily = sum_Total-sum_1Unit) %>%
# yearly and monthly avg totals
group_by(year) %>%
summarise(yearly_total = sum(sum_Total, na.rm = TRUE),
yearly_singlefamily = sum(sum_1Unit, na.rm = TRUE),
yearly_multifamily = sum(multifamily, na.rm = TRUE),
months = if_else(first(year) == "2025", 10, 12), # 2025 data thru Oct, divide by 10 for monthly data
avg_monthly_total = yearly_total / months,
avg_monthly_singlefamily = yearly_singlefamily / months,
avg_monthly_multifamily = yearly_multifamily / months,
.groups = "drop")
View(yrly_and_mnthly_avgs)
